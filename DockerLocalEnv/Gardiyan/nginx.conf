events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

server {
    listen 80;
 #   listen 443 ssl;
    server_name localhost;
#    return 301 https://$http_host$request_uri;

#    ssl_certificate /etc/nginx/certs/cert.pem;
#    ssl_certificate_key /etc/nginx/certs/key.pem;

    location / {
        proxy_pass http://auth_frontend:80/auth/;
    }

    location /auth/ {
        proxy_pass http://auth_frontend:80/auth/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
        client_max_body_size 4096M;    
    }

    location /admin/ {
        proxy_pass http://admin_frontend:80/admin/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
        client_max_body_size 4096M;    
    }
        location /client/remote/ {                 
            proxy_pass http://guacamole:8080;      
            proxy_buffering off;                   
            proxy_http_version 1.1;                
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Upgrade $http_upgrade;                     
            proxy_set_header Connection "upgrade";                      
            proxy_set_header Host $host;                                
            access_log off;                                             
            rewrite ^/client/remote/(.*) /$1 break;                     
        }  
    location /client/ {
        proxy_pass http://client_frontend:80/client/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
        proxy_buffering off;                   
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;                                
        client_max_body_size 4096M;
    }
    location /pam/ {
        proxy_pass http://pam_frontend:80/pam/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
        client_max_body_size 4096M;
        proxy_buffering off;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
    }
    location /patch/ {
        proxy_pass http://patch_frontend:80/patch/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
        client_max_body_size 4096M;
    }
    location /soc/ {
        proxy_pass http://soc_frontend:80/soc/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
        client_max_body_size 4096M;
    }
    location /network/ {
        proxy_pass http://network_frontend:80/network/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 86400;
        client_max_body_size 4096M;
    }
   # location /grafana/ {
   #     proxy_pass http://172.16.21.117:3001/grafana/;
   #     proxy_set_header Host $host;
   #     proxy_set_header X-Real-IP $remote_addr;
   #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   #     proxy_set_header X-Forwarded-Proto $scheme;
   # }
    location /repo/{
            alias /home/gardiyan/Repo/;
    }

    location /pam/download/ {
            alias /home/gardiyan/Repo/agent/receive_file/download/;
    }


    location /report/repo/ {
                        alias /home/gardiyan/Repo/report/;
    }
    location /network/repo/ {
                        alias /home/gardiyan/Repo/;
    }

    location /catalog/repo/ {
                        alias /home/gardiyan/Repo/;
    }
    location /mailRepo/ {
                        alias /home/gardiyan/Repo/report/mail/;
    }
    location /logo/ {
                        alias /home/gardiyan/Repo/report/logo/;
    }
    location /font/ {
                        alias /home/gardiyan/Repo/report/font;
                }
#
##    location /zafiyet/ {
#                        proxy_pass https://172.16.21.117:8834;
#                        rewrite ^/zafiyet/(.*) /$1 break;
#                        proxy_read_timeout 86400;
#    }
#
##    location /client/rest/ {
##                        proxy_pass http://client:7282;
##                        rewrite ^/client/rest/(.*) /$1 break;
##                        client_max_body_size 2048M;
##    }
#
    location /remote/ {
                        proxy_pass http://guacamole:8080;
                        proxy_buffering off;
                        proxy_http_version 1.1;
                        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                        proxy_set_header Upgrade $http_upgrade;
                        proxy_set_header Connection "upgrade";
                        proxy_set_header   Host $host;
                        access_log off;
                        rewrite ^/remote/(.*) /$1 break;
                }

    location /remoteRest/ {
                        proxy_pass http://guacamole:8080;
                        rewrite ^/remoteRest/(.*) /$1 break;
                        client_max_body_size 1024M;
                }



    }
}
