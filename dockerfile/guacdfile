FROM debian:bullseye

RUN apt-get update && \
    apt-get install -y \
    build-essential \
    libcairo2-dev libjpeg62-turbo-dev libpng-dev \
    libtool-bin uuid-dev freerdp2-dev \
    libpango1.0-dev libssh2-1-dev libtelnet-dev \
    libvncserver-dev libwebsockets-dev libpulse-dev \
    libssl-dev libvorbis-dev libwebp-dev \
    tightvncserver \
    wget curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src
RUN wget https://apache.org/dyn/closer.lua/guacamole/1.5.0/source/guacamole-server-1.5.0.tar.gz?action=download -O guacamole-server-1.5.0.tar.gz

RUN tar -xvzf guacamole-server-1.5.0.tar.gz && \
    cd guacamole-server-1.5.0 && \
    ./configure --with-init-dir=/etc/init.d && \
    make && \
    make install && \
    ldconfig

CMD ["/usr/local/sbin/guacd", "-b", "0.0.0.0", "-f"]